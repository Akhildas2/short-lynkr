<div class="px-4">

    <div class="mx-auto mb-4">

        <!-- Header Section -->
        <div class="flex items-center justify-between gap-3 mb-4">

            <!-- Title -->
            <h2
                class="text-lg sm:text-2xl lg:text-4xl font-extrabold tracking-tight text-gray-800 dark:text-white truncate">
                QR Management
            </h2>

            <!-- Filter Button -->
            <button [matMenuTriggerFor]="statusMenu"
                class="flex items-center gap-1.5 shrink-0 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200font-semibold hover:bg-gray-100 dark:hover:bg-gray-700transition">

                <span class="max-w-[90px] truncate">
                    {{ filterStatusLabel() }}
                </span>

                <mat-icon class="text-gray-500 dark:text-gray-300">
                    arrow_drop_down
                </mat-icon>
            </button>

            <!-- Dropdown -->
            <mat-menu #statusMenu="matMenu">
                <button mat-menu-item *ngFor="let opt of filterOptions" (click)="changeFilter(opt.value)">
                    {{ opt.label }}
                </button>
            </mat-menu>

        </div>



        <!-- Loading State -->
        <div *ngIf="isLoading" class="flex flex-col items-center justify-center flex-1 min-h-[calc(100vh-7rem-7rem)]">
            <app-spinner></app-spinner>
            <p class="text-gray-400 animate-pulse">Loading your qr codes...</p>
        </div>

        <!-- Empty state when no QR codes exist -->
        <app-empty-state *ngIf="!isLoading && socialQrs().length === 0" icon="fas fa-qrcode" title="No QR Codes Found"
            description="You havenâ€™t created any social QR codes yet. Get started by creating your first QR code."
            actionIcon="fas fa-plus-circle" actionText="Create Your First QR" actionRoute="/qr-generator">
        </app-empty-state>

        <!-- Empty state when search yields no results -->
        <app-empty-state
            *ngIf="!isLoading && socialQrs().length > 0 && filteredQrs().length === 0 && searchTerm() && !filterStatus()"
            icon="fas fa-search" title="No QR Codes Found for Your Search"
            description="No QR codes match your search term. Try refining or clearing your search."
            clearText="Clear Search" clearIcon="fas fa-times" [clearCallback]="clearSearch.bind(this)">
        </app-empty-state>

        <!-- Empty state when filter yields no results -->
        <app-empty-state
            *ngIf="!isLoading && socialQrs().length > 0 && filteredQrs().length === 0 && !searchTerm() && filterStatus()"
            icon="fas fa-filter" title="No QR Codes Match This Filter"
            description="No QR codes match your selected status filter. Try changing or clearing the filter."
            clearText="Clear Filter" clearIcon="fas fa-filter-circle-xmark" [clearCallback]="clearFilter.bind(this)">
        </app-empty-state>

        <!-- Empty state when both search and filter yield no results -->
        <app-empty-state
            *ngIf="!isLoading && socialQrs().length > 0 && filteredQrs().length === 0 && searchTerm() && filterStatus()"
            icon="fas fa-search-minus" title="No QR Codes Match Search and Filter"
            description="No QR codes match your search term and selected status filter. Try refining or clearing them."
            clearText="Clear Search & Filter" clearIcon="fas fa-times-circle"
            [clearCallback]="clearSearchAndFilter.bind(this)">
        </app-empty-state>

        <!-- QR Grid -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" *ngIf="!isLoading">

            <div *ngFor="let qr of paginatedQrs()"
                class="group relative bg-white dark:bg-gray-800 rounded-xl shadow-lg hover:shadow-2xl transition duration-300 overflow-hidden border border-gray-100 dark:border-gray-700">

                <div class="flex justify-between items-center px-4 pt-3 pb-2 border-b dark:border-gray-700 gap-2">
                    <div class="flex items-center">
                        <i [class]="getPlatformIcon(qr.platform)" [ngClass]="getPlatformColor(qr.platform)"
                            class="text-xl mr-1"></i>
                        <h3 class="font-semibold text-lg text-gray-900 dark:text-gray-100 truncate flex-shrink-0">{{
                            qr.platform }}
                        </h3>
                    </div>

                    <div class="flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider bg-opacity-10"
                        [ngClass]="getFormatClasses(qr.format) + ' border'">
                        <span class="w-2 h-2 rounded-full" [ngClass]="getFormatDotClasses(qr.format)"></span>
                        {{ qr.format | uppercase }}
                    </div>
                </div>

                <div class="p-4 flex flex-col items-center bg-gray-50 dark:bg-gray-900 relative cursor-pointer"
                    (click)="viewOrEditQr(qr, 'view')">
                    <img [src]="qr.qrCodeUrl"
                        class="w-40 h-40 object-contain rounded-lg shadow-md transition duration-300" alt="QR Code">
                    <div
                        class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 group-hover:bg-opacity-20 transition duration-300">
                        <span
                            class="opacity-0 group-hover:opacity-100 bg-blue-600 text-white px-4 py-1.5 rounded-full text-sm font-semibold shadow-lg transform translate-y-2 group-hover:translate-y-0 transition duration-300">
                            <i class="far fa-eye mr-2"></i> View QR
                        </span>
                    </div>
                </div>

                <div class="p-4 space-y-3">

                    <div class="flex flex-col">
                        <span class="text-xs font-medium text-gray-500 dark:text-gray-400">Name</span>
                        <p class="text-sm font-medium text-gray-800 dark:text-gray-200 truncate">{{ qr.userId.username
                            }}</p>
                    </div>

                    <div class="flex flex-col">
                        <span class="text-xs font-medium text-gray-500 dark:text-gray-400">Email</span>
                        <p class="text-sm font-medium text-gray-800 dark:text-gray-200 truncate">{{ qr.userId.email }}
                        </p>
                    </div>

                    <div class="flex flex-col">
                        <span class="text-xs font-medium text-gray-500 dark:text-gray-400">Target URL</span>
                        <p class="text-xs text-blue-600 dark:text-blue-400 font-medium truncate">{{ qr.accountUrl }}</p>
                    </div>

                    <div class="flex justify-end">
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full"
                            [ngClass]="QR_SIZE_COLORS[qr.size].bg">
                            Size: {{ qr.size }}
                        </span>
                    </div>
                </div>

                <div
                    class="flex justify-between border-t border-gray-200 dark:border-gray-700 px-4 py-3 bg-gray-50 dark:bg-gray-900">

                    <button (click)="viewOrEditQr(qr, 'view')"
                        class="text-sm font-semibold text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 transition duration-150">
                        <i class="far fa-eye mr-1"></i> Details
                    </button>

                    <div class="flex gap-4">
                        <button matTooltip="Edit QR" (click)="viewOrEditQr(qr, 'edit')"
                            class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition duration-150">
                            <i class="fas fa-pen text-base"></i>
                        </button>
                        <button matTooltip="Delete QR" (click)="deleteQr(qr)"
                            class="text-red-500 dark:text-red-400 hover:text-red-700 dark:hover:text-red-600 transition duration-150">
                            <i class="fas fa-trash text-base"></i>
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- Pagination -->
        <mat-paginator *ngIf="paginatedQrs().length > 8 && !isLoading" class="mt-4 flex justify-end"
            [length]="filteredQrs().length" [pageSize]="pageSize()" [pageIndex]="pageIndex()"
            [pageSizeOptions]="[ 8, 16, 32, 50, 100]" (page)="onPageChange($event)" showFirstLastButtons>
        </mat-paginator>
    </div>


    <!-- Scroll Buttons -->
    <app-scroll-buttons *ngIf="filteredQrs().length >= 15 && !isLoading" [isLoading]="isLoading"></app-scroll-buttons>

</div>